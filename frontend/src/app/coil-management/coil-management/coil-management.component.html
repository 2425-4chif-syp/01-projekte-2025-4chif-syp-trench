<div class="container mt-4 d-flex flex-column align-items-center">
  <div class="coil-container text-center mb-3">
      <h2 *ngIf="coilsService.selectedCoilIsNew">Neue Spule</h2>
      <select *ngIf="!coilsService.selectedCoilIsNew && coilsService.coils.length > 0"
          class="coil-selector form-select w-150 mx-auto" id="coilSelect"
          [(ngModel)]="selectedCoilId" (ngModelChange)="onCoilSelectionChange($event)">
          <option *ngFor="let coil of coilsService.coils" [value]="coil.id">Spule #{{ coil.id }}</option>
      </select>
  </div>

  <div *ngIf="selectedCoil" class="card shadow-sm p-4 w-100" style="max-width: 850px; min-height: 600px;">
      <div class="mb-3">
          <label for="coiltypeSelect" class="form-label">Spulentyp: <span class="text-danger">*</span></label>
          <div class="border p-2 rounded bg-light">
              <div *ngIf="selectedCoil.coiltype; else noCoiltype">
                  <p class="mb-1"><strong>ID:</strong> {{ selectedCoiltype!.id }}</p>
                  <p class="mb-0"><strong>Name:</strong> {{ selectedCoiltype!.tK_Name }}</p>
              </div>
              <ng-template #noCoiltype>
                  <p class="text-danger mb-0">Kein Spulentyp ausgewählt</p>
              </ng-template>
          </div>
          <button class="btn btn-outline-secondary btn-sm mt-2" (click)="openCoiltypeSelect()">Spulentyp ändern...</button>
      </div>

      <!-- Formulareingaben -->
      <div class="mb-3">
          <label for="auftragsNr" class="form-label">Auftrags-Nummer: <span class="text-danger">*</span></label>
          <input type="number" class="form-control" id="auftragsNr" placeholder="Auftrags-Nummer"
              [(ngModel)]="selectedCoil.auftragsnummer" min="0"
              [class.is-invalid]="saveError && isFieldInvalid('auftragsnummer')">
          <div class="invalid-feedback">Bitte geben Sie eine Auftragsnummer ein.</div>
      </div>

      <div class="mb-3">
          <label for="auftragsPosNr" class="form-label">AuftragsPosNr <span class="text-danger">*</span></label>
          <input type="number" class="form-control" id="auftragsPosNr" placeholder="AuftragsPosNr"
              [(ngModel)]="selectedCoil.auftragsPosNr" min="0"
              [class.is-invalid]="saveError && isFieldInvalid('auftragsPosNr')">
          <div class="invalid-feedback">Bitte geben Sie eine AuftragsPosNr ein.</div>
      </div>

      <div class="mb-3">
          <label for="ur" class="form-label">UR: <span class="text-danger">*</span></label>
          <input type="number" class="form-control" id="ur" placeholder="UR eingeben"
              [(ngModel)]="selectedCoil.ur" min="0"
              [class.is-invalid]="saveError && isFieldInvalid('ur')">
          <div class="invalid-feedback">Bitte geben Sie einen UR-Wert ein.</div>
      </div>

      <div class="mb-3">
          <label for="einheit" class="form-label">Einheit: <span class="text-danger">*</span></label>
          <input type="number" class="form-control" id="einheit" placeholder="Einheit"
              [(ngModel)]="selectedCoil.einheit" min="0"
              [class.is-invalid]="saveError && isFieldInvalid('einheit')">
          <div class="invalid-feedback">Bitte geben Sie eine Einheit ein.</div>
      </div>

      <div class="mb-3">
          <label for="omega" class="form-label">Omega <span class="text-danger">*</span></label>
          <input type="number" class="form-control" id="omega" placeholder="Omega"
              [(ngModel)]="selectedCoil.omega" min="0"
              [class.is-invalid]="saveError && isFieldInvalid('omega')">
          <div class="invalid-feedback">Bitte geben Sie einen Omega-Wert ein.</div>
      </div>

      <!-- Buttons -->
      <div class="d-flex justify-content-between mt-4">
          <button class="btn btn-primary w-100 me-2" (click)="saveChanges()">Speichern</button>
          <button class="btn btn-secondary w-100 me-2" (click)="backToListing()">Zurück</button>
          <button class="btn btn-danger w-100" (click)="openDeleteModal()">Löschen</button>
      </div>

      <!-- Erfolgsmeldung -->
      <div class="text-center mt-3 text-success fw-bold" *ngIf="saveMessage">
          {{ saveMessage }}
      </div>
  </div>

  <p class="text-danger text-center mt-3" *ngIf="!selectedCoil">Fehler: Spule konnte nicht geladen werden.</p>
</div>
